@page
@model AnviLightCode.Pages.User.ProductDetailModel
@{
    ViewData["Title"] = Model.Product?.TenSanPham ?? "Chi tiết sản phẩm";
}

<section id="product-detail" class="py-5 my-5 leaf-pattern-overlay">
    <div class="corner-pattern-overlay"></div>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                @if (Model.Product == null)
                {
                    <p>Sản phẩm không tồn tại.</p>
                }
                else
                {
                    <div class="row">
                        <!-- Hình ảnh sản phẩm -->
                        <div class="col-md-6">
                            <figure class="products-thumb">
                                <a href="#" class="image-hvr-effect">
                                    <img src="@Model.Product.HinhAnh" alt="@Model.Product.TenSanPham" class="single-image">
                                </a>
                            </figure>
                        </div>

                        <!-- Thông tin sản phẩm -->
                        <div class="col-md-6">
                            <div class="product-entry">
                                <h2 class="section-title divider">@Model.Product.TenSanPham</h2>
                                <div class="products-content">
                                    <div class="author-name">Thủ công bởi: AnviLight</div>
                                    <h3 class="item-title">Đèn thiết kế sẵn</h3>

                                    <!-- Lựa chọn kích thước -->
                                    <div class="size-selection mb-3">
                                        <label for="size"><strong>Kích thước:</strong></label>
                                        <select id="size" class="form-select">
                                            <option value="">-- Chọn kích thước --</option>
                                        </select>
                                    </div>

                                    <!-- Lựa chọn màu sắc -->
                                    <div class="color-selection mb-3">
                                        <label for="color"><strong>Màu sắc:</strong></label>
                                        <select id="color" class="form-select" disabled>
                                            <option value="">-- Chọn màu sắc --</option>
                                        </select>
                                    </div>

                                    <div class="btn-wrap">
                                        <button type="button" class="btn btn-outline-accent btn-accent-arrow add-to-cart" data-product-id="@Model.Product.MaSanPham">
                                            Thêm vào giỏ hàng <i class="icon icon-ns-arrow-right"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Thông tin bổ sung -->
                    <div class="row mt-5">
                        <div class="col-md-12">
                            <div class="section-header align-center">
                                <h2 class="section-title">Thông tin bổ sung</h2>
                            </div>
                            <div class="additional-info">
                                <p>
                                    @Model.Product.MoTa
                                    Đèn lồng được chế tác thủ công với thiết kế tinh xảo, mang lại không gian ấm cúng và đậm chất truyền thống cho các dịp lễ hội như Trung Thu hoặc trang trí nhà cửa.
                                </p>
                                <ul>
                                    <li><strong>Chất liệu:</strong> Tre, vải lụa cao cấp</li>
                                    <li><strong>Kích thước:</strong> 40cm (cao) x 25cm (rộng)</li>
                                    <li><strong>Trọng lượng:</strong> 600g</li>
                                    <li><strong>Nguồn sáng:</strong> Đèn LED 3W, ánh sáng vàng ấm</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</section>

<!-- Script xử lý chọn kích thước và màu sắc -->
<script>
    var bienThes = @Html.Raw(Model.BienThesJson ?? "[]");
    console.log("list biến thể");
    console.log(bienThes);

    // Lấy các thẻ HTML
    const sizeSelect = document.getElementById('size');
    const colorSelect = document.getElementById('color');

    // Tải danh sách kích thước duy nhất
    const addedSizeIds = new Set();
    bienThes.forEach(b => {
        if (!addedSizeIds.has(b.MaKichThuoc)) {
            addedSizeIds.add(b.MaKichThuoc);
            const option = document.createElement('option');
            option.value = b.MaKichThuoc;
            option.textContent = b.TenKichThuoc;
            sizeSelect.appendChild(option);
        }
    });

    // Xử lý khi chọn kích thước
    sizeSelect.addEventListener('change', function () {
        const selectedSize = parseInt(this.value);
        colorSelect.innerHTML = '<option value="">-- Chọn màu sắc --</option>';

        if (!selectedSize) {
            colorSelect.disabled = true;
            return;
        }

        // Lọc theo kích thước
        const filtered = bienThes.filter(b => b.MaKichThuoc === selectedSize);

        // Loại bỏ màu trùng lặp
        const addedColorIds = new Set();
        filtered.forEach(b => {
            if (!addedColorIds.has(b.MaMauSac)) {
                addedColorIds.add(b.MaMauSac);
                const option = document.createElement('option');
                option.value = b.MaMauSac;
                option.textContent = b.TenMauSac;
                colorSelect.appendChild(option);
            }
        });

        colorSelect.disabled = false;
    });

</script>
